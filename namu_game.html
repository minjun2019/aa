<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë¬´ê²Œì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #0b2229; 
            color: #e0e0e0;
            min-height: 100vh;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: linear-gradient(180deg, #10333d 0%, #0b2229 100%);
        }
        .container {
            max-width: 600px;
            width: 100%;
            background-color: #1a4d55; 
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5), inset 0 0 15px rgba(255, 255, 255, 0.1);
            border: 10px solid #c9a756; 
            border-radius: 20px;
            padding: 20px;
            margin: 20px 10px;
        }

        /* ì¤‘ì•™ ê²Œì„íŒ ìŠ¤íƒ€ì¼ */
        .game-panel {
            background-color: #12373f;
            border: 4px solid #c9a756;
            border-radius: 10px;
            padding: 20px 10px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }
        
        /* í•€ (ë§‰ëŒ€ê¸° ì—­í• ) - í¼ì§€ëŠ” ì •ë„ ì¡°ì ˆ */
        .peg-row {
            display: flex;
            justify-content: center;
            margin-bottom: 35px; /* í–‰ ê°„ ê°„ê²© ì¦ê°€ (ë” í¼ì§€ê²Œ) */
        }
        .peg {
            width: 5px;
            height: 5px;
            background-color: #c9a756; /* Gold Dot */
            border-radius: 50%;
            margin: 0 18px; /* í•€ ê°„ ê°„ê²©ì„ ë” ë„“ê²Œ ì¡°ì •í•˜ì—¬ í¼ì§€ëŠ” íš¨ê³¼ ì¦ëŒ€ */
            position: relative;
            box-shadow: 0 0 3px #000;
        }
        
        /* ìµœìƒë‹¨ ì¤‘ì•™ í•€ ìŠ¤íƒ€ì¼ */
        .peg[data-layer="0"][data-index="0"] {
            margin: 5px auto 20px auto !important; /* ê°€ìš´ë° ì •ë ¬ ë° ìƒí•˜ ë§ˆì§„ */
            width: 5px;
            height: 5px;
        }


        .slot {
            width: calc(100% / 6);
            padding: 10px 0;
            text-align: center;
            background-color: #3b7672; /* Darker Green Slot */
            border-right: 1px solid #c9a756;
            cursor: pointer;
            transition: background-color 0.1s, transform 0.1s;
        }
        .slot:first-child { border-left: 1px solid #c9a756; }
        .slot:hover {
            background-color: #4a918a;
            transform: translateY(-2px);
        }
        .slot-bar {
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* ê³µ ëª¨ì–‘ ë° ëª¨ì…˜ */
        .ball {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: #ffffff;
            border: 3px solid #ff4d4d;
            position: absolute;
            top: 0;
            left: 0;
            /* ê³µ ì†Œí™˜ ì‹œ ì• ë‹ˆë©”ì´ì…˜ ì œê±° */
            transition: all 0.2s ease-in-out; 
            z-index: 10;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
        }
        
        /* ë² íŒ… ì˜µì…˜ ìŠ¤íƒ€ì¼ */
        .bet-option {
            transition: all 0.2s;
            cursor: pointer;
            border: 2px solid #3b7672;
            background-color: #12373f;
        }
        .bet-option:hover {
            background-color: #1a4d55;
            transform: translateY(-1px);
        }
        .bet-option.selected {
            border: 3px solid #c9a756 !important; /* Gold Highlight */
            box-shadow: 0 0 15px rgba(201, 167, 86, 0.7);
        }
        .status-message-box {
            background-color: #c9a756; /* Gold Background */
            color: #1a4d55; /* Dark Teal Text */
            border-radius: 15px;
            border: 3px solid #e0e0e0;
            min-height: 5rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <script>
        // --- ìƒìˆ˜ ì„¤ì • ---
        const INITIAL_POINTS = 50000;
        const GAME_CYCLE_SECONDS = 60; 
        const BETTING_LOCK_SECONDS = 10; 
        const COMMISSION_RATE = 0.05; // 5%
        const BOARD_ROWS = 5; 
        const BINS = BOARD_ROWS + 1; 

        // ë°°ë‹¹ë¥  (í™•ë¥ ì˜ ì—­ìˆ˜)
        const PAYOUT_MULTIPLIERS = {
            1: 32,      
            2: 32 / 5,  // 6.4
            3: 32 / 10, // 3.2
            4: 32 / 10, // 3.2
            5: 32 / 5,  // 6.4
            6: 32      
        };

        // --- ìƒíƒœ ë³€ìˆ˜ ---
        let points = INITIAL_POINTS;
        let timer = GAME_CYCLE_SECONDS;
        let timerInterval = null;
        let isBettingOpen = true;
        let betPlaced = false; 
        let round = 1; 

        let bet = {
            amount: 100,
            type: null,
            value: null,
            slotText: '',
            isPointDeducted: false 
        };

        // --- DOM ìš”ì†Œ ìºì‹± ---
        const $points = () => document.getElementById('points');
        const $timer = () => document.getElementById('timer');
        const $roundDisplay = () => document.getElementById('roundDisplay');
        const $betAmountInput = () => document.getElementById('betAmount');
        const $betButton = () => document.getElementById('betButton');
        const $statusMessage = () => document.getElementById('statusMessage');
        const $pyramidContainer = () => document.getElementById('pyramidContainer');
        const $ball = () => document.getElementById('ball');
        const $lastResult = () => document.getElementById('lastResult');

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        function formatPoints(p) {
            // ì…ë ¥ëœ ê°’ì´ ë„ˆë¬´ í´ ê²½ìš° ì§€ìˆ˜ í‘œê¸°ë²•ì„ ë°©ì§€í•˜ê³  ì¼ë°˜ ë¬¸ìì—´ë¡œ ë°˜í™˜
            if (p > 1e15) {
                return String(p).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
            return p.toLocaleString('ko-KR');
        }

        // --- ì´ˆê¸°í™” ë° UI ì—…ë°ì´íŠ¸ ---
        function updateUI() {
            $points().textContent = formatPoints(points);
            
            // ê¸ˆì•¡ ì…ë ¥ í•„ë“œ ê°’ ì—…ë°ì´íŠ¸ (toLocaleString ì—†ì´ ìˆœìˆ˜ ìˆ«ì/ë¬¸ìì—´ë¡œ)
            const betInput = $betAmountInput();
            if (betInput) {
                // ì…ë ¥ í•„ë“œì˜ í˜„ì¬ ê°’ì„ ê°€ì ¸ì™€ bet.amountì— ë°˜ì˜ (ìˆ˜ë™ ì…ë ¥ ë•Œë¬¸)
                // ë² íŒ… ê¸ˆì•¡ì´ 0ë³´ë‹¤ ì‘ìœ¼ë©´ 0ìœ¼ë¡œ ê³ ì • (ìŒìˆ˜ ë°©ì§€)
                bet.amount = Math.max(0, parseInt(betInput.value) || 0);
                
                // [ìˆ˜ì •] bet.amountì˜ ì‹¤ì œ ê°’ìœ¼ë¡œ input valueë¥¼ ë®ì–´ì”ë‹ˆë‹¤.
                // ì´ëŠ” ë²„íŠ¼ì´ bet.amountë¥¼ ì—…ë°ì´íŠ¸í•œ í›„ í˜¸ì¶œë˜ì—ˆì„ ë•Œ,
                // input í•„ë“œì—ë„ ì´ ê°’ì´ ë°˜ì˜ë˜ê²Œ í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.
                betInput.value = String(bet.amount);
            }
            
            $roundDisplay().textContent = round;
            
            // ë² íŒ… ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™” ì¡°ê±´
            $betButton().disabled = !isBettingOpen || betPlaced || bet.amount <= 0 || bet.amount > points || !bet.type;
            
            // ë² íŒ… ë§ˆê°(isBettingOpen=false) ë˜ëŠ” ë² íŒ… ì™„ë£Œ(betPlaced=true) ì‹œ ê¸ˆì•¡ ì…ë ¥ í•„ë“œ ë° ë²„íŠ¼ ë¹„í™œì„±í™”
            const betInputDisabled = !isBettingOpen || betPlaced;
            if (betInput) betInput.disabled = betInputDisabled;

            const $amountButtons = document.querySelectorAll('.amount-modifier-btn');
            $amountButtons.forEach(btn => btn.disabled = betInputDisabled);
            // --------------------------------------------------------------------
            
            // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
            const minutes = Math.floor(timer / 60);
            const seconds = timer % 60;
            $timer().textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            // ë² íŒ… ìƒíƒœ ë©”ì‹œì§€
            if (!isBettingOpen) {
                $statusMessage().innerHTML = `<span class="font-black">ğŸš¨ ë² íŒ… ë§ˆê°! ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤. ğŸš¨</span>`;
            } else if (betPlaced) {
                // ë² íŒ… ê¸ˆì•¡ì„ ì…ë ¥ëœ ê°’ (bet.amount) ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œ
                $statusMessage().innerHTML = `<span class="font-black">âœ… ë² íŒ… ì™„ë£Œ! ${formatPoints(bet.amount)} Pê°€ ì°¨ê°ë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</span>`;
            } else if (timer <= BETTING_LOCK_SECONDS) {
                $statusMessage().innerHTML = `<span class="font-black">â³ ê³§ ë§ˆê°! ${timer}ì´ˆ ë‚¨ì•˜ìŠµë‹ˆë‹¤.</span>`;
            } else if (bet.type) {
                $statusMessage().innerHTML = `<span class="font-black">âœ”ï¸ ë² íŒ… ì¤€ë¹„ ì™„ë£Œ: ${bet.slotText} ì— ${formatPoints(bet.amount)} í¬ì¸íŠ¸</span>`;
            } else {
                $statusMessage().innerHTML = `ì›í•˜ëŠ” ë² íŒ… ì¢…ë¥˜ì™€ ê¸ˆì•¡ì„ ì„ íƒí•˜ì„¸ìš”.`;
            }

            // ë² íŒ… ì˜µì…˜ í•˜ì´ë¼ì´íŠ¸ ì´ˆê¸°í™”
            document.querySelectorAll('.bet-option').forEach(el => el.classList.remove('selected'));
            if (bet.type && bet.value) {
                // bet.valueê°€ ìˆ«ìê°€ ì•„ë‹Œ ê²½ìš°ë„ ìˆìœ¼ë¯€ë¡œ ID í˜•ì‹ì„ ë¬¸ìì—´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
                const id = bet.type === 'EXACT' ? `opt-${bet.type}-${bet.value}` : `opt-${bet.type}-${bet.value}`;
                const selectedElement = document.getElementById(id);
                if (selectedElement) {
                    selectedElement.classList.add('selected');
                }
            }
        }

        // --- íƒ€ì´ë¨¸ ë° ê²Œì„ ë¡œì§ ---
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timer--;
                if (timer <= BETTING_LOCK_SECONDS && isBettingOpen) {
                    isBettingOpen = false;
                    // ë² íŒ… ë§ˆê° ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸í•˜ì—¬ ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
                    updateUI(); 
                }
                
                if (timer < 0) {
                    clearInterval(timerInterval);
                    timer = GAME_CYCLE_SECONDS;
                    isBettingOpen = true; 
                    runGame();
                }
                updateUI();
            }, 1000);
        }

        async function runGame() {
            // 1. ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰ ë° ê²°ê³¼ ê³„ì‚°
            const { finalSlot, firstMove, path } = runSimulation();
            
            const currentBet = { ...bet };
            const currentRound = round; 
            
            // 2. ê³µ ì‹œê°í™” ë° ì• ë‹ˆë©”ì´ì…˜
            $ball().style.display = 'block';
            
            const animationStepDelay = 150; 
            const finalDropDuration = 500; 
            const highlightDuration = 1000;

            // [ìˆ˜ì •] ê³µ ëª¨ì…˜ ì‹¤í–‰
            await animateBall(path, animationStepDelay, finalDropDuration, highlightDuration);

            // 3. ë‹¹ì²¨ê¸ˆ ê³„ì‚° ë° ê²°ê³¼ ë©”ì‹œì§€ ìƒì„±
            let netPayout = 0; 
            const resultSlotText = `${finalSlot}ë²ˆ`;
            const resultParityText = finalSlot % 2 === 0 ? 'ì§ìˆ˜' : 'í™€ìˆ˜';
            const resultFirstMoveText = firstMove === 'L' ? 'ì¢Œ' : 'ìš°';

            // ìš”ì²­í•˜ì‹  ê²°ê³¼ í˜•ì‹: níšŒì°¨ ê²°ê³¼: në²ˆ / í™€ìˆ˜ / ì¢Œ
            let resultMessage = `${currentRound}íšŒì°¨ ê²°ê³¼: **${resultSlotText} / ${resultParityText} / ${resultFirstMoveText}**`;
            
            let betInfo = ''; // ë² íŒ… ì •ë³´ëŠ” ìµœì¢… ê²°ê³¼ ì˜†ì— ì‘ê²Œ í‘œì‹œ

            if (betPlaced) { 
                const betAmount = currentBet.amount;
                // ë² íŒ… ì •ë³´ë¥¼ ê°„ê²°í•˜ê²Œ í‘œì‹œ (ì˜ˆ: (ë² íŒ…: 1~3ë²ˆ ê·¸ë£¹))
                betInfo = `(ë² íŒ…: ${currentBet.slotText})`; 
                
                const payout = calculateWinnings(currentBet, finalSlot, firstMove);
                netPayout = payout.netPayout; 
                
                if (netPayout > betAmount) {
                    const profit = netPayout - betAmount;
                    resultMessage += `<span class="text-green-300 font-bold ml-4">ğŸ‰ ìŠ¹ë¦¬! (+${formatPoints(profit)} P ìˆœì´ìµ) ${betInfo}</span>`;
                } else if (netPayout === 0) { 
                    resultMessage += `<span class="text-red-300 font-bold ml-4">ğŸ˜¢ íŒ¨ë°°. (${formatPoints(betAmount)} P ì†ì‹¤) ${betInfo}</span>`;
                } else {
                    // (ì›ê¸ˆ íšŒìˆ˜) ê°™ì€ ìƒí™©ì´ ë°œìƒí•  ê²½ìš°
                    resultMessage += `<span class="text-gray-400 ml-4">ë¬´ìŠ¹ë¶€. (0 P ë³€í™”) ${betInfo}</span>`;
                }
                
                points += netPayout; 
            } else {
                resultMessage += `<span class="text-gray-400 ml-4">ë² íŒ…í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</span>`;
            }

            // 4. ê²°ê³¼ ì¶œë ¥ ë° í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
            $lastResult().innerHTML = resultMessage;
            
            // 5. ë‹¤ìŒ ë¼ìš´ë“œ ì¤€ë¹„
            round++; 
            bet = { amount: 100, type: null, value: null, slotText: '', isPointDeducted: false }; 
            betPlaced = false; 
            startTimer();
            updateUI();
        }

        // --- ì‹œë®¬ë ˆì´ì…˜ ë° ì• ë‹ˆë©”ì´ì…˜ ---
        function runSimulation() {
            let rights = 0;
            let path = [];
            let firstMove = null;

            // ê° í•€ì—ì„œ 1/2 í™•ë¥ ë¡œ ì¢Œ/ìš° ì„ íƒ
            for (let i = 0; i < BOARD_ROWS; i++) {
                const move = Math.random() < 0.5 ? 'L' : 'R';
                if (i === 0) { firstMove = move; }
                path.push(move);
                if (move === 'R') { rights++; }
            }
            const finalSlot = rights + 1;
            return { finalSlot, firstMove, path };
        }

        async function animateBall(path, animationStepDelay, finalDropDuration, highlightDuration) {
            const ball = $ball();
            const pyramid = $pyramidContainer();
            const slots = document.querySelectorAll('.slot');
            
            // ìµœìƒë‹¨ í•€ (ì‹œì‘ì ) ì°¾ê¸°
            const startPeg = pyramid.querySelector('.peg[data-layer="0"][data-index="0"]');
            if (!startPeg) return;

            // 1. ê³µ ì´ˆê¸°í™” ë° ì‹œì‘ ìœ„ì¹˜ ê³„ì‚°
            ball.style.transition = 'none'; 
            
            await new Promise(resolve => setTimeout(resolve, 0)); 
            
            const startX = startPeg.offsetLeft + startPeg.offsetWidth / 2 - ball.offsetWidth / 2;
            const startY = startPeg.offsetTop - ball.offsetHeight; // í•€ ë°”ë¡œ ìœ„ì—ì„œ ì‹œì‘

            ball.style.transform = `translate(${startX}px, ${startY}px)`;
            
            let currentPeg = startPeg;
            let currentPathIndex = 0; 
            
            // 2. í•€ ì‚¬ì´ ëª¨ì…˜
            // ê³µì˜ ì›€ì§ì„ì—ë§Œ transition ì ìš©
            ball.style.transition = `all ${animationStepDelay / 1000}s ease-in-out`; 

            for (let i = 0; i < BOARD_ROWS; i++) {
                await new Promise(resolve => setTimeout(resolve, animationStepDelay));

                const move = path[i];
                let nextPeg = null;
                
                const currentLayer = parseInt(currentPeg.dataset.layer);
                const currentIndex = parseInt(currentPeg.dataset.index);

                let nextIndex = currentIndex;
                if (move === 'R') {
                    nextIndex = currentIndex + 1;
                    currentPathIndex++; 
                }

                nextPeg = pyramid.querySelector(`.peg[data-layer="${currentLayer + 1}"][data-index="${nextIndex}"]`);

                if (nextPeg) {
                    currentPeg = nextPeg;
                    // ë‹¤ìŒ í•€ ìœ„ì¹˜ë¡œ ì´ë™ (í•€ ì¤‘ì•™ X, í•€ ìƒë‹¨ Y)
                    const nextX = nextPeg.offsetLeft + nextPeg.offsetWidth / 2 - ball.offsetWidth / 2;
                    const nextY = nextPeg.offsetTop - ball.offsetHeight; 
                    
                    ball.style.transform = `translate(${nextX}px, ${nextY}px)`; 
                } else {
                    break;
                }
            }

            await new Promise(resolve => setTimeout(resolve, animationStepDelay));

            // 3. ìµœì¢… ìŠ¬ë¡¯ìœ¼ë¡œ ë‚™í•˜
            const finalSlotIndex = currentPathIndex; 
            const finalSlotElement = slots[finalSlotIndex];
            
            if (finalSlotElement) {
                const slotCenterX = finalSlotElement.offsetLeft + finalSlotElement.offsetWidth / 2;
                const finalY = finalSlotElement.offsetTop - (ball.offsetHeight / 2); // ìŠ¬ë¡¯ ì¤‘ì•™ ìƒë‹¨
                
                ball.style.transition = `all ${finalDropDuration / 1000}s ease-in`;
                ball.style.transform = `translate(${slotCenterX - (ball.offsetWidth / 2)}px, ${finalY}px)`;
            }

            await new Promise(resolve => setTimeout(resolve, finalDropDuration));
            
            // 4. ê³µ ìˆ¨ê¸°ê¸° ë° í•˜ì´ë¼ì´íŠ¸
            ball.style.display = 'none'; 
            ball.style.transition = 'none'; 

            if (finalSlotElement) {
                finalSlotElement.classList.add('bg-yellow-600', 'animate-pulse');
                await new Promise(resolve => setTimeout(resolve, highlightDuration));
                finalSlotElement.classList.remove('bg-yellow-600', 'animate-pulse');
            }
        }


        // --- ë² íŒ… ë¡œì§ ---
        function handleBetSelection(type, value, text) {
            if (!isBettingOpen || betPlaced) {
                if (!isBettingOpen) $statusMessage().innerHTML = `<span class="font-black text-red-700">âŒ ë² íŒ… ë§ˆê°!</span>`;
                if (betPlaced) $statusMessage().innerHTML = `<span class="font-black text-red-700">âŒ ì´ë¯¸ ì´ë²ˆ íšŒì°¨ì— ë² íŒ…í–ˆìŠµë‹ˆë‹¤.</span>`;
                return;
            }
            
            if (bet.type === type && bet.value === value) {
                bet.type = null;
                bet.value = null;
                bet.slotText = '';
            } else {
                bet.type = type;
                bet.value = value;
                bet.slotText = text;
            }
            updateUI();
        }

        function calculateWinnings(betData, finalSlot, firstMove) {
            const betAmount = betData.amount;
            let isWin = false;
            let grossPayoutMultiplier = 0; 

            // 1. ìŠ¹íŒ¨ íŒë‹¨ ë° ë°°ìˆ˜ ê²°ì •
            switch (betData.type) {
                case 'EXACT': 
                    if (finalSlot === betData.value) {
                        isWin = true;
                        grossPayoutMultiplier = PAYOUT_MULTIPLIERS[finalSlot];
                    }
                    break;
                case 'GROUP': 
                    const resultGroup = finalSlot <= 3 ? '1-3' : '4-6';
                    if (resultGroup === betData.value) {
                        isWin = true;
                        grossPayoutMultiplier = 2;
                    }
                    break;
                case 'PARITY': 
                    const resultParity = finalSlot % 2 === 0 ? 'EVEN' : 'ODD';
                    if (resultParity === betData.value) {
                        isWin = true;
                        grossPayoutMultiplier = 2;
                    }
                    break;
                case 'FIRST': 
                    if (firstMove === betData.value) {
                        isWin = true;
                        grossPayoutMultiplier = 2;
                    }
                    break;
            }

            // 2. ìµœì¢… ì§€ê¸‰ì•¡ (Net Payout) ê³„ì‚°
            let netPayout = 0;

            if (isWin) {
                // ìŠ¹ë¦¬ ì‹œ: (ì›ê¸ˆ íšŒìˆ˜) + (ë² íŒ…ê¸ˆ x ìŠ¹ë¦¬ ë°°ìˆ˜) x 95%
                
                const totalGrossWinnings = betAmount * grossPayoutMultiplier;
                // í° ìˆ«ìì˜ ì •ë°€ë„ ìœ ì§€ë¥¼ ìœ„í•´ Math.floorë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, JavaScriptëŠ” 2^53ê¹Œì§€ëŠ” ì •ìˆ˜ ì •í™•ë„ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.
                const netPrizeWithFee = Math.floor(totalGrossWinnings * (1 - COMMISSION_RATE)); 
                
                // ìµœì¢… ì§€ê¸‰ì•¡ (ì›ê¸ˆ + ìˆœ ìƒê¸ˆ)
                netPayout = betAmount + netPrizeWithFee;
                
                return { netPayout: netPayout };

            } else {
                // íŒ¨ë°° ì‹œ: ì›ê¸ˆ ëŒë ¤ë°›ì§€ ëª»í•¨ (Net Payout = 0)
                netPayout = 0;
                return { netPayout: netPayout }; 
            }
        }
        
        // [ìˆ˜ì •] ë² íŒ… ê¸ˆì•¡ì„ ì¦ê°ì‹œí‚¤ëŠ” í•¨ìˆ˜
        function modifyBetAmount(modifier) {
            // isBettingOpen, betPlaced ìƒíƒœë¥¼ í•œ ë²ˆ ë” í™•ì¸í•˜ì—¬ ê¸ˆì•¡ ë³€ê²½ì´ ë¶ˆê°€ëŠ¥í•œ ìƒíƒœì¸ì§€ í™•ì¸
            if (!isBettingOpen || betPlaced) {
                return;
            }
            
            let newAmount;
            
            if (modifier === 'all') {
                newAmount = points;
            } else {
                // í˜„ì¬ ì…ë ¥ëœ ê°’(input.value)ì„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°
                const currentInputAmount = parseInt($betAmountInput().value) || 0;
                newAmount = currentInputAmount + modifier;
            }
            
            // ê¸ˆì•¡ì€ 0ë³´ë‹¤ í¬ê±°ë‚˜ ê°™ì•„ì•¼ í•˜ê³ , ë³´ìœ  í¬ì¸íŠ¸ë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
            newAmount = Math.max(0, Math.min(points, newAmount));
            
            // bet.amount ì—…ë°ì´íŠ¸
            bet.amount = newAmount;

            // [ìˆ˜ì •] ì…ë ¥ í•„ë“œì— ì§ì ‘ ê°’ì„ ì„¤ì •í•˜ì—¬ ì‚¬ìš©ìê°€ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ í•¨
            const betInput = $betAmountInput();
            if (betInput) {
                betInput.value = String(bet.amount);
            }
            
            // bet.amountë¥¼ ì—…ë°ì´íŠ¸í–ˆìœ¼ë¯€ë¡œ UIë¥¼ ë‹¤ì‹œ ê·¸ë¦½ë‹ˆë‹¤.
            updateUI();
        }


        // --- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---
        function placeBet() {
            if (!isBettingOpen) {
                $statusMessage().innerHTML = `<span class="font-black text-red-700">âŒ ë² íŒ… ë§ˆê°! ë‹¤ìŒ ê²Œì„ê¹Œì§€ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</span>`;
                return;
            }
            if (betPlaced) {
                $statusMessage().innerHTML = `<span class="font-black text-red-700">âŒ ì´ë¯¸ ì´ë²ˆ íšŒì°¨ì— ë² íŒ…í–ˆìŠµë‹ˆë‹¤. (1íšŒ ì œí•œ)</span>`;
                return;
            }
            if (bet.amount <= 0 || bet.amount > points) {
                $statusMessage().innerHTML = `<span class="font-black text-red-700">âŒ ë² íŒ… ê¸ˆì•¡ì´ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.</span>`;
                return;
            }
            if (!bet.type) {
                $statusMessage().innerHTML = `<span class="font-black text-red-700">âŒ ë² íŒ… ì˜µì…˜ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.</span>`;
                return;
            }

            // ğŸ’¡ ë² íŒ… ì‹œì‘ ì‹œ í¬ì¸íŠ¸ ì°¨ê°
            points -= bet.amount;
            bet.isPointDeducted = true;
            betPlaced = true; 
            
            $statusMessage().innerHTML = `<span class="font-black">âœ… ë² íŒ… ì„±ê³µ! ${formatPoints(bet.amount)} Pê°€ ì°¨ê°ë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</span>`;
            updateUI(); 
        }

        // --- ì´ˆê¸° ë Œë”ë§ ---
        function renderPyramid() {
            const container = $pyramidContainer();
            // ê³µì˜ ì´ˆê¸° ìœ„ì¹˜ë¥¼ ìœ„í•œ ë¹ˆ í–‰
            let html = '<div class="peg-row h-[20px] relative"><div id="ball" class="ball" style="display:none;"></div></div>';
            
            // ìµœìƒë‹¨ í•€ì€ ì¤‘ì•™ì— í•˜ë‚˜ë§Œ
            html += `<div class="peg-row" data-layer="0">
                        <div class="peg" data-layer="0" data-index="0"></div>
                     </div>`;
            
            let pegCount = 2; // ë‹¤ìŒ ë ˆì´ì–´ë¶€í„° í•€ì´ 2ê°œ
            
            // í•€ ë ˆì´ì–´
            for (let layer = 1; layer <= BOARD_ROWS; layer++) {
                let rowHtml = `<div class="peg-row" data-layer="${layer}">`;
                
                for (let i = 0; i < pegCount; i++) {
                    rowHtml += `<div class="peg" data-layer="${layer}" data-index="${i}"></div>`;
                }
                rowHtml += '</div>';
                html += rowHtml;
                pegCount++;
            }
            
            // ìµœì¢… ìŠ¬ë¡¯ (Bin)
            html += `<div class="flex slot-bar mt-2">`;
            for (let i = 1; i <= BINS; i++) {
                let multiplier = PAYOUT_MULTIPLIERS[i];
                html += `<div class="slot flex flex-col justify-center items-center text-sm font-extrabold text-white" id="opt-EXACT-${i}" data-value="${i}" onclick="handleBetSelection('EXACT', ${i}, '${i}ë²ˆ ìŠ¬ë¡¯')">
                            <span class="text-3xl">${i}</span>
                            <span class="text-yellow-200 text-xs">ë°°ë‹¹ ${multiplier.toFixed(1)}</span>
                        </div>`;
            }
            html += '</div>';

            container.innerHTML = html;
        }

        // --- ì´ˆê¸° ì‹¤í–‰ ---
        document.addEventListener('DOMContentLoaded', () => {
            renderPyramid();
            startTimer();
            $lastResult().innerHTML = 'ì•„ì§ ë² íŒ… ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.';
            
            // DOMContentLoaded ì‹œì ì— input ê°’ì„ bet.amountì— ë°˜ì˜í•˜ì—¬ UI ë™ê¸°í™”
            const initialBetInput = $betAmountInput();
            if (initialBetInput) {
                bet.amount = parseInt(initialBetInput.value) || 100;
            }
            updateUI();

            $betAmountInput().addEventListener('input', (e) => {
                // ì…ë ¥ ê°’ì´ ë°”ë€Œë©´ bet.amount ì—…ë°ì´íŠ¸
                const value = parseInt(e.target.value) || 0;
                bet.amount = Math.max(0, value);
                updateUI();
            });
            
            $betButton().addEventListener('click', placeBet);
        });
    </script>

    <div class="container">
        <h1 class="text-2xl font-black text-center text-yellow-300 mb-6 border-b-2 border-yellow-300 pb-2">
            ë‚˜ë¬´ê²Œì„
        </h1>

        <div class="game-panel mb-6 p-4">
            <div class="text-center mb-4">
                <p class="text-xl font-bold text-gray-200">ë‹¤ìŒ ë‚˜ë¬´ê²Œì„ì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.</p>
                <div class="text-3xl font-black text-yellow-300 mt-2">
                    <span id="roundDisplay">1</span>íšŒì°¨ ëŒ€ê¸° ì¤‘ <span id="timer">00:30</span>
                </div>
            </div>
            <div id="lastResult" class="text-center text-sm p-3 bg-gray-900 border border-gray-600 rounded-lg">
                </div>
        </div>

        <div class="game-panel mb-8 p-6">
            <h2 class="text-xl font-bold mb-4 text-center text-yellow-200">ê²Œì„íŒ</h2>
            <div id="pyramidContainer" class="w-full relative py-4">
                </div>
        </div>
        
        <div class="bg-gray-900 p-5 rounded-lg border-2 border-yellow-500 shadow-inner">
            <div class="status-message-box p-3 text-center mb-4">
                <p id="statusMessage" class="text-xl font-bold"></p>
            </div>
            
            <h2 class="text-xl font-bold mb-4 text-yellow-300">ë² íŒ…í•˜ê¸° (íšŒì°¨ë‹¹ 1íšŒ ì œí•œ)</h2>
            
            <div class="mb-4">
                <label for="betAmount" class="block text-sm font-medium text-gray-300 mb-2">ë² íŒ… ê¸ˆì•¡ (P)</label>
                <div class="flex space-x-2">
                    <input type="number" id="betAmount" min="100" class="w-full p-3 rounded-lg bg-gray-800 text-white border border-yellow-600 focus:ring-yellow-500 focus:border-yellow-500" value="100">
                    
                    <button onclick="modifyBetAmount(1000);" class="px-3 py-2 bg-yellow-600 hover:bg-yellow-700 text-black rounded-lg text-sm font-semibold transition amount-modifier-btn">+1ì²œ</button>
                    <button onclick="modifyBetAmount(10000);" class="px-3 py-2 bg-yellow-600 hover:bg-yellow-700 text-black rounded-lg text-sm font-semibold transition amount-modifier-btn">+1ë§Œ</button>
                    <button onclick="modifyBetAmount('all');" class="px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-semibold transition amount-modifier-btn">ALL IN</button>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-3 mb-6">
                <div id="opt-GROUP-1-3" onclick="handleBetSelection('GROUP', '1-3', '1~3ë²ˆ ê·¸ë£¹')" class="bet-option p-3 rounded-lg text-center">
                    <p class="text-lg font-bold text-blue-300">1 ~ 3ë²ˆ</p>
                    <p class="text-xs text-gray-400">ë°°ë‹¹ 2.0</p>
                </div>
                <div id="opt-PARITY-ODD" onclick="handleBetSelection('PARITY', 'ODD', 'í™€ìˆ˜')" class="bet-option p-3 rounded-lg text-center">
                    <p class="text-lg font-bold text-purple-300">í™€ìˆ˜</p>
                    <p class="text-xs text-gray-400">ë°°ë‹¹ 2.0</p>
                </div>
                <div id="opt-FIRST-L" onclick="handleBetSelection('FIRST', 'L', 'ì¢Œ')" class="bet-option p-3 rounded-lg text-center">
                    <p class="text-lg font-bold text-orange-300">ì¢Œ</p>
                    <p class="text-xs text-gray-400">ë°°ë‹¹ 2.0</p>
                </div>

                <div id="opt-GROUP-4-6" onclick="handleBetSelection('GROUP', '4-6', '4~6ë²ˆ ê·¸ë£¹')" class="bet-option p-3 rounded-lg text-center">
                    <p class="text-lg font-bold text-blue-300">4 ~ 6ë²ˆ</p>
                    <p class="text-xs text-gray-400">ë°°ë‹¹ 2.0</p>
                </div>
                <div id="opt-PARITY-EVEN" onclick="handleBetSelection('PARITY', 'EVEN', 'ì§ìˆ˜')" class="bet-option p-3 rounded-lg text-center">
                    <p class="text-lg font-bold text-purple-300">ì§ìˆ˜</p>
                    <p class="text-xs text-gray-400">ë°°ë‹¹ 2.0</p>
                </div>
                <div id="opt-FIRST-R" onclick="handleBetSelection('FIRST', 'R', 'ìš°')" class="bet-option p-3 rounded-lg text-center">
                    <p class="text-lg font-bold text-orange-300">ìš°</p>
                    <p class="text-xs text-gray-400">ë°°ë‹¹ 2.0</p>
                </div>
            </div>
            
            <button id="betButton" class="w-full p-4 rounded-lg bg-green-700 hover:bg-green-800 text-white text-xl font-black transition disabled:bg-gray-500 disabled:cursor-not-allowed">
                ë² íŒ… ì‹¤í–‰
            </button>
        </div>

        <div class="text-center pt-4 text-sm text-yellow-300">
            <div class="font-bold">ë³´ìœ  í¬ì¸íŠ¸: <span id="points" class="text-2xl ml-1">50,000</span> P</div>
        </div>
    </div>
</body>
</html>